import{C as s,c as T,a as o,P as d}from"./chromeInterfaces.6466d284.js";const l=async()=>{let e={active:!0,lastFocusedWindow:!0},[n]=await chrome.tabs.query(e);return n};chrome.action.onClicked.addListener(async e=>{!e.id||chrome.tabs.sendMessage(e.id,{action:s.TOGGLE_MODAL})});chrome.runtime.onMessage.addListener(function(e,n,a){if(e.action===s.CREATE_TAB&&chrome.tabs.create({url:e.url,active:!0}),e.action===s.GET_CURRENT_TAB&&l().then(t=>{a(t)}),e.action===s.GET_FAVICON){const t=new URL(chrome.runtime.getURL("/_favicon/"));t.searchParams.set("pageUrl",e.url),t.searchParams.set("size","32"),a(t.toString())}return e.action===s.REQ_SESSION&&fetch(T.AUTH_SESSION,{mode:"cors"}).then(async t=>{if(!t.ok)return a(null);const r=await t.json();if(!r)return a(null);a(r)}).catch(t=>{a(null)}),!0});chrome.runtime.onConnect.addListener(async function(e){return console.assert(e.name===o.GPT_REQUEST),e.onMessage.addListener(function(n){if(n.port===o.GPT_REQUEST){const a=n;fetch(T.GENERATE_GPT_STREAM,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:a.messages,max_tokens:a.max_tokens?a.max_tokens:1/0}),mode:"cors"}).then(async t=>{if(!t.ok)return e.postMessage({port:o.ERROR,error:d.GPT_FAIL,message:await t.text(),statusText:t.statusText});const r=t.body;if(!r)return e.postMessage({port:o.ERROR,error:d.GPT_FAIL,message:"No data"});const R=r.getReader(),m=new TextDecoder;let i=!1;for(;!i;){const{value:E,done:c}=await R.read();i=c;const u=m.decode(E);e.postMessage({port:o.GPT_REQUEST,value:u,done:c})}})}}),!0});
